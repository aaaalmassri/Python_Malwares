#!/usr/bin/env python3

"""
 - This Module Is Socket Reverse Connection Server .
 - TCP Socket Server For Reverse Connection Handler .
"""

import socket

try:
    MSG_HEADER: int = 1024
    MSG_FORMAT: str = "utf-8"
    DISCONNECT_MSG: str = "!DISCONNECT"
    SERVER_IP: str = (
        "192.168.100.4"  # | socket.gethostbyname(socket.gethostname())
    )
    SERVER_PORT_No: int = 5678
    ADDR: tuple = (SERVER_IP, SERVER_PORT_No)

    with socket.socket(
        family=socket.AF_INET, type=socket.SOCK_STREAM
    ) as SERVER:
        print("[SERVER] STARTING ... ")
        SERVER.bind(ADDR)
        SERVER.listen(1)
        print(f"[SERVER] START LISTING AT {ADDR}")
        connection, address = SERVER.accept()
        with connection:
            connected = True
            while connected:
                # MSG: str = connection.recv(MSG_HEADER).decode(MSG_FORMAT)
                # if MSG == DISCONNECT_MSG:
                #     connected = False
                # print(f"[CONNECTION] ADDR {address} MESSAGE : {MSG} ")
                S_MSG: str = input("[MESSAGE] : ")
                connection.send(bytes(S_MSG, MSG_FORMAT))
                if S_MSG == DISCONNECT_MSG:
                    connected = False


except socket.error as err:
    print(f"[SOCKET] ERROR {err}")
except KeyboardInterrupt:
    print("[SERVER-CONNECTION] STOPPED ")
